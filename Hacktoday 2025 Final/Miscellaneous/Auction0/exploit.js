require("dotenv").config()
const { ethers } = require("ethers")
const provider = new ethers.providers.JsonRpcProvider(process.env.RPC_URL)
const setupAddr = process.env.SETUP_ADDR

const setupABI = [
  "function auction() view returns (address)",
  "function isSolved() view returns (bool)",
  "function nft() view returns (address)",
  "function tokenId() view returns (uint256)",
]

async function main() {
  const setup = new ethers.Contract(setupAddr, setupABI, provider)
  const auctionAddr = await setup.auction()
  const nftAddr = await setup.nft()
  const tokenId = await setup.tokenId()

  console.log("auction :", auctionAddr)
  console.log("nft     :", nftAddr)
  console.log("tokenId :", tokenId.toString())

  const auctionABI = [
    "function Balance() view returns (uint256)",
    "function targetAmount() view returns (uint256)",
    "function bids() view returns (uint256)",
    "function uniqueBidders() view returns (uint256)",
    "function lastBidder() view returns (address)",
    "function ended() view returns (bool)",
  ]
  const auction = new ethers.Contract(auctionAddr, auctionABI, provider)
  console.log(
    "auction balance :",
    ethers.utils.formatEther(await auction.Balance()),
    "ether"
  )
  console.log(
    "targetAmount    :",
    ethers.utils.formatEther(await auction.targetAmount()),
    "ether"
  )
  console.log("bids            :", (await auction.bids()).toString())
  console.log("uniqueBidders   :", (await auction.uniqueBidders()).toString())
  console.log("lastBidder      :", await auction.lastBidder())
  console.log("ended           :", await auction.ended())

  try {
    console.log("isSolved        :", await setup.isSolved())
  } catch (e) {
    console.log("isSolved revert :", e.reason)
  }
}

main().catch(console.error)
