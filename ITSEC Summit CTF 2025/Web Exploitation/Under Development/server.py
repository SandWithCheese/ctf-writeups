from flask import Flask, request, make_response, send_file
from datetime import datetime
import os

app = Flask(__name__)
PORT = 8080  # Or any port you can expose


@app.route("/image.png")
def serve_png():
    image_path = "image.png"  # Make sure this file exists in the same directory
    if not os.path.exists(image_path):
        return "Image not found", 404
    return send_file(image_path, mimetype="image/png")


@app.route(
    "/",
    defaults={"path": ""},
    methods=["GET", "POST", "PUT", "DELETE", "OPTIONS", "PATCH"],
)
@app.route("/<path:path>", methods=["GET", "POST", "PUT", "DELETE", "OPTIONS", "PATCH"])
def log_request(path):
    print("---")
    print(f"Request Received at: {datetime.utcnow().isoformat()}Z")
    print(f"Method: {request.method}")
    print(f"Path: /{path}")
    print("Headers:")
    for header, value in request.headers.items():
        print(f"  {header}: {value}")
    print("---\n")

    # Respond with 204 No Content so the bot doesn't hang
    return make_response("", 204)


if __name__ == "__main__":
    print(f"[+] Intercept server listening on http://localhost:{PORT}")
    app.run(host="0.0.0.0", port=PORT)
