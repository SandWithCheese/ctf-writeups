import base64
from sympy.ntheory.modular import crt
from sympy import cbrt
from Crypto.Util.number import long_to_bytes
from Crypto.Cipher import AES

enc = "/mcZBbbHDypRP3bcgHnz4Uxx4ouLVLQ+SOJb0+3IR/aIMp7p+quFgANv+2rWaIxZfNg6pNQvIjRBEALWt2Ltog=="
iv = "MTQ5MDI0ODk3NjYyODY1Mw=="

cts = [
    "ATMkxDJEm2v/c/lTq/5vwpDbEreqTO9TMPhJy2LdbQhz6TYBPpm5IJdYKTA4QSTMkpEFq710KQUPmQdKfIOAn3x7gDHKqz760YxZhiNhI+qa9sP3Jl5seeN1CwUk6D1T",
    "ATMkxDJEm2v/c/lTq/5vwpDbEreqTO9TMPhJy2LdbQhz6TYBPpm5IJdYKTA4QSTMkpEFq710KQUPmQdKfIOAn3x7gDHKqz760YxZhiNhI+qa9sP3Jl5seeN1CwUk6D1T",
    "ATMkxDJEm2v/c/lTq/5vwpDbEreqTO9TMPhJy2LdbQhz6TYBPpm5IJdYKTA4QSTMkpEFq710KQUPmQdKfIOAn3x7gDHKqz760YxZhiNhI+qa9sP3Jl5seeN1CwUk6D1T",
]
public_keys = [
    (
        3,
        71133758437006038056326172091721299053609445980066813533097450396882000263183799198334958634674350750364337062526840438247431341987014528669429220686257714936583334363551142340079498956283087185959015797539142708931737856085159674190900999308444949727291116184742764329875860331877990032609387154336948007463,
    ),
    (
        3,
        125941037778323291862181710137279566520507783337269181617438481976673153096352231005001269298590265483741776227907173891288068230359909790427621939632966925613197250042001429866919367235598617037223833210192706336684268168284412261695214574281327836845269118313635153767786284267264522161308296572085413709307,
    ),
    (
        3,
        94367108756513647846862299793403299930242645546085334894581075152164127523540295475710466034627931299443141702561946726197412688973006421667952239462299564714317521701006495867745002883414985183756381904918340610167590875954520157144644993889898982254580024164794730076274449307240869151872616289417359703771,
    ),
]


n_array = [x[1] for x in public_keys]
c_array = [base64.b64decode(x) for x in cts]
c_array = [int.from_bytes(x, "big") for x in c_array]

m = crt(n_array, c_array)[0]

aes_key = long_to_bytes(cbrt(m))
iv = base64.b64decode(iv)
enc = base64.b64decode(enc)

print(aes_key)
print(iv)

cipher = AES.new(aes_key, AES.MODE_CBC, iv)
print(cipher.decrypt(enc))
